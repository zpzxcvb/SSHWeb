package com.zhangpan.ssh.action;

import java.io.IOException;
import java.io.StringReader;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletResponse;

import org.apache.struts2.ServletActionContext;
import org.dom4j.Attribute;
import org.dom4j.Document;
import org.dom4j.Element;
import org.dom4j.io.SAXReader;
import org.xml.sax.InputSource;

import com.opensymphony.xwork2.ModelDriven;
import com.zhangpan.ssh.vo.UserVo;

public class FlowchartshowingAction {

	private StringBuffer flowJson = new StringBuffer();
	private Map<String, Object> map = new HashMap<String, Object>();
	
	
	public String GoJsXml() throws IOException{
		String xml = "<?xml version='1.0' encoding='UTF-8'?><process-template xmlns:xmi='http://www.omg.org/XMI' xmlns:com.ibm.model.processTemplate='http:///com/ibm/model/processTemplate/processTemplate.ecore' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmi:version='2.0' name='集团总部日常支撑申请单' label='JTZBRCZC' version='1.0.0' sequence='' category='' form='' modules='' operations='' domains='' modelType='1' extendLabel='' extendVersion=''><notion notions='' highlight='' sequence='' isSort='true' sequencenum='' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/><privilege type='0' relation='or' draftLevel='' draftOrg='' draftRole='' subOrg='0' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/><start-state name='流程开始' sid='step1' xlocation='280' ylocation='340' sequence='1' modelType='1' stateType='1'><transition name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='310,340,423,340,'/></start-state><end-state name='流程结束' sid='step0' xlocation='1320' ylocation='330' sequence='0' modelType='1' stateType='1'></end-state><state name='起草人' sid='step10' sequence='10' fields='' xlocation='480' ylocation='340' stateType='0' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'><stateNotion availabel='0'/><stateDoc docEdit='1' notes='0'/><stateNotify/><transition name='报账系统管理员' to='step20' returnBack='false' rejectBack='false' modelType='1' points='537,340,673,340,'/><transition name='管理信息部归口人' to='xxbgkrStep' returnBack='true' rejectBack='false' modelType='1' points='479,372,479,482,1040,482,1040,374,' handlesCount='2'/></state><state name='报账系统管理员' sid='step20' sequence='20' fields='' xlocation='730' ylocation='340' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'><stateNotion availabel='0'/><stateDoc docEdit='1' notes='0'/><stateNotify/><transition name='管理信息部归口人' to='xxbgkrStep' returnBack='false' rejectBack='false' modelType='1' points='787,340,983,340,'/><transition name='流程结束' to='step0' returnBack='false' rejectBack='false' modelType='1' points='730,372,730,447,1320,447,1320,360,' handlesCount='2'/><transition name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='730,308,730,276,480,276,480,308,' handlesCount='2'/></state><state name='管理信息部归口人' sid='xxbgkrStep' sequence='30' fields='' xlocation='1040' ylocation='340' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'><stateNotion availabel='0'/><stateDoc docEdit='1' notes='0'/><stateNotify/><transition name='流程结束' to='step0' returnBack='false' rejectBack='false' modelType='1' points='1097,337,1290,331,'/><transition name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1039,306,1039,240,480,240,480,308,' handlesCount='2' description='copyPath'/></state></process-template>";
//		String xml = "<?xml version='1.0'?> <process-template xmlns:xmi='http://www.omg.org/XMI' xmlns:com.ibm.model.processTemplate='http:///com/ibm/model/processTemplate/processTemplate.ecore' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmi:version='2.0' name='集团业务招待费报账流程' label='JTZBYWZDBZ' version='1.0.0' sequence='' category='' form='' modules='' operations='' domains='' modelType='1' extendLabel='' extendVersion=''> <notion  notions='' highlight='' sequence='' isSort='true' sequencenum='' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/> <privilege  type='0' relation='or' draftLevel='' draftOrg='' draftRole='' subOrg='0' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/> <start-state name='流程开始' sid='step1' xlocation='160' ylocation='90' sequence='1' modelType='1' stateType='1'> <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='180,120,218,178,'/> </start-state> <end-state name='流程结束' sid='step0' xlocation='990' ylocation='490' sequence='0' modelType='1' stateType='1'> </end-state> <state  name='起草人' sid='step10' sequence='10' fields='' xlocation='241' ylocation='211' stateType='0' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'> <stateNotion  availabel='0'/> <stateDoc  docEdit='1' notes='0'/> <stateNotify/> <transition  name='核算会计初核' to='step201' returnBack='false' rejectBack='false' modelType='1' points='260,243,320,338,'/> </state> <state  name='核算会计初核' sid='step201' sequence='20' fields='' xlocation='341' ylocation='371' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'> <stateNotion  availabel='0'/> <stateDoc  docEdit='1' notes='0'/> <stateNotify/>  <transition  name='核算会计复核' to='step203' returnBack='false' rejectBack='false' modelType='1' points='398,371,515,371,'/> <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='284,371,240,371,240,243,' handlesCount='1'/> </state> <state  name='核算会计复核' sid='step203' sequence='30' fields='' xlocation='572' ylocation='372' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'> <stateNotion  availabel='0'/> <stateDoc  docEdit='1' notes='0'/> <stateNotify/> <transition  name='核算会计审核' to='step202' returnBack='false' rejectBack='false' modelType='1' points='629,372,755,372,'/> <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='572,404,572,460,240,460,240,243,' handlesCount='2'/> </state> <state  name='核算会计审核' sid='step202' sequence='40' fields='' xlocation='812' ylocation='372' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'> <stateNotion  availabel='0'/> <stateDoc  docEdit='1' notes='0'/> <stateNotify/> <transition  name='流程结束' to='step0' returnBack='false' rejectBack='false' modelType='1' points='859,403,944,460,'/> <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='812,404,812,516,240,516,240,243,' handlesCount='2' description='copyPath'/> </state> </process-template>";
//		String xml = "<?xml version='1.0'?> <process-template xmlns:xmi='http://www.omg.org/XMI' xmlns:com.ibm.model.processTemplate='http:///com/ibm/model/processTemplate/processTemplate.ecore' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmi:version='2.0' name='异地任职周转房审批流程' label='JTZBRZZZ' version='1.0.0' sequence='' category='' form='' modules='' operations='' domains='' modelType='1' extendLabel='' extendVersion=''>    <notion  notions='' highlight='' sequence='' isSort='true' sequencenum='' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/>    <privilege  type='0' relation='or' draftLevel='' draftOrg='' draftRole='' subOrg='0' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/>    <start-state name='流程开始' sid='step1' xlocation='146' ylocation='89' sequence='1' modelType='1' stateType='1'>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='164,120,253,270,'/>    </start-state>    <end-state name='流程结束' sid='step0' xlocation='1680' ylocation='530' sequence='0' modelType='1' stateType='1'>    </end-state>    <state  name='起草人' sid='step10' sequence='10' fields='' xlocation='273' ylocation='303' stateType='0' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='核算会计初核' to='step201' returnBack='false' rejectBack='false' modelType='1' points='272,271,272,227,467,227,468,268,' handlesCount='2'/>        <transition  name='处室领导审批' to='csldStep' returnBack='false' rejectBack='false' modelType='1' points='272,271,272,189,701,189,701,270,' handlesCount='2'/>        <transition  name='部门领导审批' to='cwldStep' returnBack='false' rejectBack='false' modelType='1' points='272,271,272,151,910,151,910,269,' handlesCount='2'/>        <transition  name='人力资源部总部人力资源处正职领导审批' to='zbrlzzldStep' returnBack='false' rejectBack='false' modelType='1' points='271,270,270,114,1129,114,1129,262,' handlesCount='2'/>        <transition  name='核算会计审核' to='step202' returnBack='true' rejectBack='false' modelType='1' points='272,271,270,64,1442,64,1442,270,' handlesCount='2'/>    </state>    <state  name='处室领导审批' sid='csldStep' sequence='20' fields='' xlocation='702' ylocation='302' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='部门领导审批' to='cwldStep' returnBack='false' rejectBack='false' modelType='1' points='759,301,854,301,'/>        <transition  name='处室其他领导审批' to='csqtldStep' returnBack='false' rejectBack='false' modelType='1' points='741,334,768,356,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='701,334,701,920,173,920,178,300,215,300,' handlesCount='3'/>    </state>    <state  name='处室其他领导审批' sid='csqtldStep' sequence='30' fields='' xlocation='810' ylocation='390' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='部门领导审批' to='cwldStep' returnBack='false' rejectBack='false' modelType='1' points='848,356,874,333,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='810,422,810,956,173,956,178,300,215,300,' handlesCount='3'/>    </state>    <state  name='部门领导审批' sid='cwldStep' sequence='40' fields='' xlocation='911' ylocation='301' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='人力资源部总部人力资源处正职领导审批' to='zbrlzzldStep' returnBack='false' rejectBack='false' modelType='1' points='968,300,1073,300,'/>        <transition  name='部门其他领导审批' to='qtldStep' returnBack='false' rejectBack='false' modelType='1' points='946,333,982,366,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='910,333,910,992,173,992,178,301,215,301,' handlesCount='3'/>    </state>    <state  name='部门其他领导审批' sid='qtldStep' sequence='50' fields='' xlocation='1020' ylocation='400' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='人力资源部总部人力资源处正职领导审批' to='zbrlzzldStep' returnBack='false' rejectBack='false' modelType='1' points='1057,366,1083,342,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='963,400,933,400,933,1033,172,1033,179,300,215,300,' handlesCount='4'/>    </state>    <state  name='人力资源部总部人力资源处正职领导审批' sid='zbrlzzldStep' sequence='60' fields='' xlocation='1130' ylocation='300' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='人力资源部部门领导审批' to='rlldStep' returnBack='false' rejectBack='false' modelType='1' points='1167,342,1189,366,' handlesCount=''/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1129,338,1129,449,957,449,957,1066,171,1066,179,299,215,300,' handlesCount='5'/>    </state>    <state  name='人力资源部部门领导审批' sid='rlldStep' sequence='70' fields='' xlocation='1220' ylocation='400' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='综合部服务中心行政管理处正职领导审批' to='zhxzzzldStep' returnBack='false' rejectBack='false' modelType='1' points='1163,400,1100,400,1100,468,' handlesCount='1'/>        <transition  name='人力资源部部门其他领导审批' to='rlqtldStep' returnBack='false' rejectBack='false' modelType='1' points='1277,400,1299,400,1299,476,' handlesCount='1'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1277,423,1483,508,1483,1277,170,1277,180,299,215,300,' handlesCount='4'/>    </state>    <state  name='人力资源部部门其他领导审批' sid='rlqtldStep' sequence='80' fields='' xlocation='1300' ylocation='510' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='综合部服务中心行政管理处正职领导审批' to='zhxzzzldStep' returnBack='false' rejectBack='false' modelType='1' points='1243,510,1157,510,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1357,533,1417,559,1417,1235,170,1235,180,299,215,300,' handlesCount='4'/>    </state>    <state  name='综合部服务中心行政管理处正职领导审批' sid='zhxzzzldStep' sequence='90' fields='' xlocation='1100' ylocation='510' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='综合部部门领导审批' to='zhbldStep' returnBack='false' rejectBack='false' modelType='1' points='1100,552,1100,576,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1157,533,1328,602,1328,1201,170,1201,179,299,215,300,' handlesCount='4'/>    </state>    <state  name='综合部部门领导审批' sid='zhbldStep' sequence='100' fields='' xlocation='1100' ylocation='610' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='起草人确认' to='step20' returnBack='false' rejectBack='false' modelType='1' points='1157,611,1220,611,1220,659,' handlesCount='1'/>        <transition  name='综合部部门其他领导审批' to='zhbqtldStep' returnBack='false' rejectBack='false' modelType='1' points='1043,609,1019,609,1019,656,' handlesCount='1'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1157,610,1290,610,1290,1168,170,1168,179,301,215,301,' handlesCount='4'/>    </state>    <state  name='综合部部门其他领导审批' sid='zhbqtldStep' sequence='110' fields='' xlocation='1020' ylocation='690' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='起草人确认' to='step20' returnBack='false' rejectBack='false' modelType='1' points='1077,690,1163,690,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1019,722,1019,1092,171,1092,179,300,215,300,' handlesCount='3'/>    </state>    <state  name='核算会计初核' sid='step201' sequence='130' fields='' xlocation='470' ylocation='300' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='413,300,330,302,'/>        <transition  name='核算会计复核' to='step203' returnBack='false' rejectBack='false' modelType='1' points='438,332,402,368,'/>    </state>    <state  name='核算会计复核' sid='step203' sequence='140' fields='' xlocation='370' ylocation='400' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='313,400,272,400,272,335,' handlesCount='1'/>        <transition  name='核算会计审核' to='step202' returnBack='false' rejectBack='false' modelType='1' points='370,368,370,42,1440,42,1441,270,' handlesCount='2'/>        <transition  name='财务部总部财务处处长审批' to='zbcwcczStep' returnBack='false' rejectBack='false' modelType='1' points='370,432,370,456,'/>    </state>    <state  name='财务部总部财务处处长审批' sid='zbcwcczStep' sequence='150' fields='' xlocation='370' ylocation='490' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='核算会计审核' to='step202' returnBack='false' rejectBack='false' modelType='1' points='427,490,575,490,575,84,1440,84,1441,270,' handlesCount='3'/>        <transition  name='财务部部门副职领导审批' to='cwfzldStep' returnBack='false' rejectBack='false' modelType='1' points='370,524,370,556,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='313,490,272,490,272,335,' handlesCount='1'/>    </state>    <state  name='财务部部门副职领导审批' sid='cwfzldStep' sequence='160' fields='' xlocation='370' ylocation='590' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='核算会计审核' to='step202' returnBack='false' rejectBack='false' modelType='1' points='427,590,573,590,573,83,1440,83,1441,270,' handlesCount='3'/>        <transition  name='财务部部门正职领导审批' to='cwzzldStep' returnBack='false' rejectBack='false' modelType='1' points='332,624,307,646,'/>        <transition  name='财务部其他领导审批（副职）' to='cwqtldfzStep' returnBack='false' rejectBack='false' modelType='1' points='397,624,422,656,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='313,590,270,590,271,334,' handlesCount='1'/>    </state>    <state  name='财务部其他领导审批（副职）' sid='cwqtldfzStep' sequence='170' fields='' xlocation='450' ylocation='690' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='核算会计审核' to='step202' returnBack='false' rejectBack='false' modelType='1' points='507,689,573,689,573,82,1440,82,1441,270,' handlesCount='3'/>        <transition  name='财务部部门正职领导审批' to='cwzzldStep' returnBack='false' rejectBack='false' modelType='1' points='393,686,327,683,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='450,722,450,750,174,750,180,300,215,300,' handlesCount='3'/>    </state>    <state  name='财务部部门正职领导审批' sid='cwzzldStep' sequence='180' fields='' xlocation='270' ylocation='680' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='核算会计审核' to='step202' returnBack='false' rejectBack='false' modelType='1' points='269,712,269,769,571,769,576,84,1440,84,1441,270,' handlesCount='4'/>        <transition  name='公司分管领导' to='gsfgldStep' returnBack='false' rejectBack='false' modelType='1' points='287,714,344,828,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='270,648,271,334,'/>    </state>    <state  name='公司分管领导' sid='gsfgldStep' sequence='190' fields='' xlocation='360' ylocation='860' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='核算会计审核' to='step202' returnBack='false' rejectBack='false' modelType='1' points='417,859,573,859,573,84,1440,84,1441,270,' handlesCount='3'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='303,860,174,860,179,300,215,300,' handlesCount='2'/>    </state>    <state  name='核算会计审核' sid='step202' sequence='200' fields='' xlocation='1442' ylocation='302' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='流程结束' to='step0' returnBack='false' rejectBack='false' modelType='1' points='1475,334,1647,499,'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1456,334,1536,515,1541,1319,169,1319,179,299,215,300,' handlesCount='4' description='copyPath'/>    </state>    <state  name='起草人确认' sid='step20' sequence='20' fields='' xlocation='1221' ylocation='691' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'>        <stateNotion  availabel='0'/>        <stateDoc  docEdit='1' notes='0'/>        <stateNotify/>        <transition  name='核算会计初核' to='step201' returnBack='false' rejectBack='false' modelType='1' points='1221,723,1221,760,793,760,793,458,527,327,' handlesCount='3'/>        <transition  name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1220,723,1220,1129,171,1129,179,299,215,300,' handlesCount='3'/>    </state></process-template>";
		HttpServletResponse response = ServletActionContext.getResponse();
		response.setContentType("text/html;charset=utf-8");
		response.getWriter().write(xmlElements(xml));
		return null;
	}
	
	
	public static void main(String[] args) {
		String xml = "<?xml version='1.0' encoding='UTF-8'?><process-template xmlns:xmi='http://www.omg.org/XMI' xmlns:com.ibm.model.processTemplate='http:///com/ibm/model/processTemplate/processTemplate.ecore' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmi:version='2.0' name='集团总部日常支撑申请单' label='JTZBRCZC' version='1.0.0' sequence='' category='' form='' modules='' operations='' domains='' modelType='1' extendLabel='' extendVersion=''><notion notions='' highlight='' sequence='' isSort='true' sequencenum='' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/><privilege type='0' relation='or' draftLevel='' draftOrg='' draftRole='' subOrg='0' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001'/><start-state name='流程开始' sid='step1' xlocation='280' ylocation='340' sequence='1' modelType='1' stateType='1'><transition name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='310,340,423,340,'/></start-state><end-state name='流程结束' sid='step0' xlocation='1320' ylocation='330' sequence='0' modelType='1' stateType='1'></end-state><state name='起草人' sid='step10' sequence='10' fields='' xlocation='480' ylocation='340' stateType='0' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'><stateNotion availabel='0'/><stateDoc docEdit='1' notes='0'/><stateNotify/><transition name='报账系统管理员' to='step20' returnBack='false' rejectBack='false' modelType='1' points='537,340,673,340,'/><transition name='管理信息部归口人' to='xxbgkrStep' returnBack='true' rejectBack='false' modelType='1' points='479,372,479,482,1040,482,1040,374,' handlesCount='2'/></state><state name='报账系统管理员' sid='step20' sequence='20' fields='' xlocation='730' ylocation='340' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'><stateNotion availabel='0'/><stateDoc docEdit='1' notes='0'/><stateNotify/><transition name='管理信息部归口人' to='xxbgkrStep' returnBack='false' rejectBack='false' modelType='1' points='787,340,983,340,'/><transition name='流程结束' to='step0' returnBack='false' rejectBack='false' modelType='1' points='730,372,730,447,1320,447,1320,360,' handlesCount='2'/><transition name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='730,308,730,276,480,276,480,308,' handlesCount='2'/></state><state name='管理信息部归口人' sid='xxbgkrStep' sequence='30' fields='' xlocation='1040' ylocation='340' stateType='1' assignmentOption='1' expandOption='2' assignmentDisplay='1' assignmentType='2' submitCondition='1' execType='4001' competeType='5001' modelType='1'><stateNotion availabel='0'/><stateDoc docEdit='1' notes='0'/><stateNotify/><transition name='流程结束' to='step0' returnBack='false' rejectBack='false' modelType='1' points='1097,337,1290,331,'/><transition name='起草人' to='step10' returnBack='false' rejectBack='false' modelType='1' points='1039,306,1039,240,480,240,480,308,' handlesCount='2' description='copyPath'/></state></process-template>";
		String s=new FlowchartshowingAction().xmlElements(xml);
		System.out.println(s);
	}
	
	
	public String xmlElements(String xml) {
		flowJson.append("{\"class\":\"go.GraphLinksModel\",\"nodeDataArray\":[");
		// 创建一个新的字符串
		StringReader read = new StringReader(xml);
		// 创建新的输入源SAX 解析器将使用 InputSource 对象来确定如何读取 XML 输入
		InputSource source = new InputSource(read);
		// 创建一个新的SAXBuilder
		SAXReader sb = new SAXReader();
		try {
			Document document = sb.read(source);
			Element root = document.getRootElement();
			List<Element> childElements = root.elements();
			for(int i=0;i<childElements.size();i++){
				headXml(childElements.get(i), i);
			}
			
			flowJson.deleteCharAt(flowJson.length()-1);
			flowJson.append("],\"linkDataArray\":[");

			for(int i=0;i<childElements.size();i++){
				List<Attribute> attributeList = childElements.get(i).attributes();
				if(attributeList.size()>0){
					String headSid = "";
					for(int j=0;j<attributeList.size();j++){
						if("sid".equals(attributeList.get(j).getName())){
							headSid = attributeList.get(j).getValue();
						}
					}
					if(isValid(headSid.trim())){
						lineXml(childElements.get(i), headSid);
					}
				}
			}
			flowJson.deleteCharAt(flowJson.length()-2);
			flowJson.append("]}");
			return flowJson.toString();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}

	
	
	public String headXml(Element childElement, int no){
		
		List<Attribute> attributeList = childElement.attributes();
		for (Attribute attr : attributeList) {
			if("name".equals(attr.getName())){
				if("流程开始".equals(attr.getValue())){
					flowJson.append("{\"key\":"+"\""+no+"\""+", \"text\":"+"\""+attr.getValue()+"\""+", \"fill\":\"#4fba4f\", ");
				}else if("流程结束".equals(attr.getValue())){
					flowJson.append("{\"key\":"+"\""+no+"\""+", \"text\":"+"\""+attr.getValue()+"\""+", \"fill\":\"#CE0620\", ");	
				}else{
					flowJson.append("{\"key\":"+"\""+no+"\""+", \"text\":"+"\""+attr.getValue()+"\", \"fill\":\"#778899\", ");
				}
			}
			if("xlocation".equals(attr.getName())){
				flowJson.append("\"loc\":"+"\""+attr.getValue()+"");
			}
			if("ylocation".equals(attr.getName())){
				flowJson.append(" "+attr.getValue()+"\""+"},");
			}
			if("sid".equals(attr.getName())){
				map.put(attr.getValue(), no);
			}
		}
		return null;
	}
	
	
	
	public String lineXml(Element childElement, String headSid){
		
		List<Element> elementList = childElement.elements();
		for (Element ele : elementList) {
			Iterator attributeIterator = ele.attributeIterator();
			int flag = 0;
			while (attributeIterator.hasNext()) {
				Attribute a = (Attribute) attributeIterator.next();
				if("to".equals(a.getName())){
					if(isValid(map.get(a.getValue())) || isValid(map.get(headSid))){
						if(!"step10".equals(a.getValue()) || "step1".equals(headSid)){
							flowJson.append("{\"from\":"+"\""+map.get(headSid).toString()+"\""+", \"to\":"+"\""+map.get(a.getValue()).toString()+"\", ");
							flag = flag + 1;
						}
					}
				}
				if("points".equals(a.getName())){
					if(flag == 1){
					if(!"step10".equals(a.getValue()) || "step1".equals(headSid)){
						String pointsTemp = a.getValue();
						String points = pointsTemp.substring(0, pointsTemp.length()-1);
						flowJson.append("\"points\":["+points+"]}, ");
					}
					}
				}
			}
		}
		return null;
	}
	
	// 判空
	public boolean isValid(Object obj) {
		if (obj != null && !"".equals(obj)) {
			return true;
		}
		return false;
	}

}
