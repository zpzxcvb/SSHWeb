<!DOCTYPE html>
<html>
<head>
	<title>菜单信息列表</title>
	<link rel="stylesheet" href="/js/lib/layui/css/layui.css">
	<link rel="stylesheet" href="/js/lib/zTree/css/zTreeStyle/zTreeStyle.css">
	
	<script type="text/javascript" src="/js/lib/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="/js/lib/layui/layui.js"></script>
	<script type="text/javascript" src="/js/lib/zTree/jquery.ztree.core.js"></script>
	<script type="text/javascript" src="/js/lib/zTree/jquery.ztree.excheck.js"></script>
</head>
<body>
	<div class="layui-row layui-col-space10">
		<div class="layui-col-md2">
			<div class="layui-card">
				<div class="layui-card-body">
					<ul id="menuTree" class="ztree"></ul>
				</div>
			</div>
		</div>
		<div class="layui-col-md10">
			<div class="layui-card">
				<div class="layui-card-header">
					<div class="layui-inline table-search">
						<div class="layui-input-inline">
				    		<input class="layui-input" id="key" type="search" placeholder="请输入菜单名称">
				    	</div>
				    	<a id="searchModel" class="layui-btn layui-btn-sm"><i class="layui-icon layui-icon-search"></i> 查询</a>
				  	</div>
				</div>
				<div class="layui-card-body">
					<div id="" class="layui-btn-container">
						<a id="addModel" class="layui-btn"><i class="layui-icon layui-icon-add-1"></i>添加</a>
						<a id="deleteModel" class="layui-btn layui-btn-danger"><i class="layui-icon layui-icon-delete"></i>批量删除</a>
					</div>
					<table id="table" lay-filter="table_event"></table>
				</div>
			</div>
		</div>
	</div>
	<script type="text/html" id="statusTpl">
		{{#	if(d.pid != 1){	}}
				<input type='checkbox' name='status' lay-skin='switch' lay-text='启用|禁用' lay-filter='status' {{ d.status == 1 ? 'checked' : '' }} value='{{d.id}}'>
		{{#	}	}}
	</script>
	<script type="text/html" id="rowbarTpl">
		<a title="编辑" class="layui-btn layui-btn-xs" lay-event="editModel"><i class="layui-icon layui-icon-edit"></i></a>
	</script>
	<script type="text/javascript" src="/js/myjs.js"></script>
	<script>
		var table,tableIns,tableId='table';
		function initTable(table){
			var params = {
				 id: "#table",
				 url: "/sys/menu/pageList",
				 columns: [
			    	{type: 'checkbox', fixed: 'left'},
			      	{type: 'numbers', title: '序号', fixed: 'left'},
			      	{field: 'menuName', title: '菜单名称'},
			      	{field: 'orderNo', title: '排序'},
			      	{field: 'parentName', title: '父级'},
			      	{field: 'url', title: '链接地址'},
			      	{field: 'description', title: '描述'},
			      	{field: 'status', title: '状态', width: 100, fixed: 'right', sort: true, templet: '#statusTpl'},
			      	{fixed: 'right', title:'操作', fixed: 'right', toolbar: '#rowbarTpl'}
			    ]
			};
			tableIns = table_layui(table, params);
		}

		layui.use('table', function() {
			form = layui.form;
			table = layui.table;
			//初始化tree(非异步)
			initTree({
				id : "menuTree",
				async : false,
				check : false,
				url : "/sys/menu/menuList"
			});
			//初始化table
			initTable(table);
			//监听按钮事件
			initFunction();
			//监听指定开关
			switchStatusForUpdate(form, 'status', "/sys/menu/update", "id");
		});
		var active = {
			searchModel : function(table) {
				var key = $("#key").val();
				tableIns.reload({
					where : {
						key : key
					}
				});
			},
			addModel : function() {
				openDialog('/sys/menu/saveOrUpdate');
			},
			deleteModel : function() {
				confirm_Delete("/sys/menu/deleteByIds", "id");
			},
			editModel : function(data) {
				openDialog('/sys/menu/saveOrUpdate?id='+data.id);
			}
		}
		function zTreeClick(event, treeId, treeNode) {
			tableIns.reload({
				where : {
					pid : treeNode.id
				}
			});
		}
	</script>
</body>
</html>